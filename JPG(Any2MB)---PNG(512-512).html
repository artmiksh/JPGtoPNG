<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JPEG → PNG 512×512</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f7fafc;color:#0f172a;margin:0;padding:20px}
    .card{width:720px;max-width:100%;background:white;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.08);padding:24px}
    h1{margin:0 0 8px;font-size:20px}
    p{margin:0 0 16px;color:#475569}
    .drop{border:2px dashed #cbd5e1;border-radius:8px;padding:28px;text-align:center;cursor:pointer}
    .drop.hover{background:#f1f5f9}
    #preview, #result{display:block;margin:16px auto 0;max-width:100%;border-radius:6px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:16px}
    button{background:#0ea5a4;border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    button:disabled{opacity:.5;cursor:default}
    .note{margin-top:12px;color:#64748b;font-size:13px}
    .err{color:#b91c1c}
    .caption{text-align:center;font-size:14px;color:#334155;margin-top:4px}
  </style>
</head>
<body>
  <div class="card">
    <h1>JPEG → PNG 512×512</h1>
    <p>Upload a square JPEG (1:1). The image will be centered, cropped if necessary to a square, resized to 512×512, and saved as PNG. Maximum input file size: 2 MB.</p>

    <div id="drop" class="drop">Drag and drop JPEG here or click to select<br><small>(only .jpg /.jpeg, ≤ 2 MB)</small></div>
    <input id="file" type="file" accept="image/jpeg" style="display:none" />

    <img id="preview" alt="Original preview" style="display:none" />
    <div id="previewCaption" class="caption" style="display:none">Original JPEG</div>

    <div class="controls">
      <button id="convert" disabled>Convert and Download PNG</button>
      <a id="downloadLink" style="display:none; text-decoration:none;"> </a>
      <div id="status" style="margin-left:auto;color:#334155"></div>
    </div>

    <img id="result" alt="Converted PNG preview" style="display:none" />
    <div id="resultCaption" class="caption" style="display:none">PNG 512×512</div>

    <div class="note">Requirements:
      <ul>
        <li>Input format: JPEG (.jpg / .jpeg)</li>
        <li>Maximum input file size: 2 MB</li>
        <li>Output file: PNG 512×512</li>
      </ul>
    </div>

    <div id="error" class="err" role="alert" style="display:none;margin-top:12px"></div>
  </div>

<script>
(function(){
  const MAX_BYTES = 2 * 1024 * 1024; // 2 MB
  const CANVAS_SIZE = 512;
  const fileInput = document.getElementById('file');
  const drop = document.getElementById('drop');
  const preview = document.getElementById('preview');
  const previewCaption = document.getElementById('previewCaption');
  const resultImg = document.getElementById('result');
  const resultCaption = document.getElementById('resultCaption');
  const convertBtn = document.getElementById('convert');
  const status = document.getElementById('status');
  const errorEl = document.getElementById('error');
  const downloadLink = document.getElementById('downloadLink');

  let currentFile = null;

  function showError(msg){ errorEl.style.display='block'; errorEl.textContent = msg; }
  function clearError(){ errorEl.style.display='none'; errorEl.textContent=''; }

  drop.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', e => handleFiles(e.target.files));

  ;['dragenter','dragover'].forEach(ev=>{
    drop.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add('hover'); });
  });
  ;['dragleave','drop'].forEach(ev=>{
    drop.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove('hover'); });
  });
  drop.addEventListener('drop', e=>{
    const dt = e.dataTransfer; if(!dt) return; handleFiles(dt.files); });

  function handleFiles(files){
    clearError();
    if(!files || files.length===0) return;
    const f = files[0];
    if(!/^image\/(jpeg|jpg)$/.test(f.type) && !/\.jpe?g$/i.test(f.name)){
      showError('Error: only JPEG (.jpg / .jpeg) files are accepted.'); return;
    }
    if(f.size > MAX_BYTES){
      showError('Error: file size too large. Maximum 2 MB.'); return;
    }
    const reader = new FileReader();
    reader.onload = ev => {
      const img = new Image();
      img.onload = ()=>{
        preview.src = ev.target.result;
        preview.style.display = 'block';
        previewCaption.style.display = 'block';
        status.textContent = `Original size: ${img.width}×${img.height}, file ${Math.round(f.size/1024)} KB`;
        convertBtn.disabled = false;
        currentFile = {file:f,image:img};
      };
      img.onerror = ()=> showError('Failed to read image as JPEG.');
      img.src = ev.target.result;
    };
    reader.onerror = ()=> showError('File read error.');
    reader.readAsDataURL(f);
  }

  convertBtn.addEventListener('click', ()=>{
    clearError();
    if(!currentFile) return;
    const img = currentFile.image;
    const srcW = img.naturalWidth || img.width;
    const srcH = img.naturalHeight || img.height;
    const s = Math.min(srcW, srcH);
    const sx = Math.round((srcW - s)/2);
    const sy = Math.round((srcH - s)/2);

    const canvas = document.createElement('canvas');
    canvas.width = CANVAS_SIZE; canvas.height = CANVAS_SIZE;
    const ctx = canvas.getContext('2d');

    if(ctx.imageSmoothingEnabled){ ctx.imageSmoothingEnabled = true; ctx.imageSmoothingQuality = 'high'; }

    ctx.drawImage(img, sx, sy, s, s, 0, 0, CANVAS_SIZE, CANVAS_SIZE);

    canvas.toBlob(function(blob){
      if(!blob){ showError('Error: failed to create PNG.'); return; }
      const outName = (currentFile.file.name.replace(/\.[^.]+$/, '') || 'image') + '.png';
      const url = URL.createObjectURL(blob);

      // Immediate download
      downloadLink.href = url;
      downloadLink.download = outName;
      downloadLink.style.display='inline-block';
      downloadLink.textContent = 'Download PNG ('+Math.round(blob.size/1024)+' KB)';
      downloadLink.click();

      // Show result image on page
      resultImg.src = url;
      resultImg.style.display = 'block';
      resultCaption.style.display = 'block';

      status.textContent = `Done — PNG: ${CANVAS_SIZE}×${CANVAS_SIZE}, ${Math.round(blob.size/1024)} KB`;
    }, 'image/png');
  });

})();
</script>
</body>
</html>